#!/bin/bash
#
# Add package file to repository
#
# 20150726 MV: Initial version for freight
# 20151106 MV: Delete removal of original file
#              Get filename from possible path given as argument
# 20161119 MV: Removed wheeze from target repositories
#
set -e
test "$1" = "-q" && { QUIET="> /dev/null 2>&1" ; shift; }
test $# -ne 1 && { echo "Usage: torepo <filename>"; exit 1; }
for pkg in $*
do
   test -f $pkg || { echo "No such file $pkg."; exit 1; }
   filename=$( basename $pkg )
   scp -q $pkg repo@repo:/tmp
   ssh repo@repo "freight add /tmp/$filename apt/jessie $QUIET; rm /tmp/$filename $QUIET"
done
ssh repo@repo "freight cache $QUIET"
